---
description: |
  This is how the shortcodes would look like in action
title: Twitter Topics - Gritty Edition
weight: 7
---

<link href="/rmarkdown-libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="/rmarkdown-libs/anchor-sections/anchor-sections.js"></script>


<!-- Reference: https://gist.github.com/bryangoodrich/7b5ef683ce8db592669e -->
<!-- # Twitter Topic Modeling Using R -->
<!-- # Author: Bryan Goodrich -->
<div id="load-libraries" class="section level3">
<h3>Load libraries</h3>
<pre class="r"><code>library(twitteR)
## Warning: package &#39;twitteR&#39; was built under R version 4.0.3
library(NLP)
## Warning: package &#39;NLP&#39; was built under R version 4.0.3
library(tm)
## Warning: package &#39;tm&#39; was built under R version 4.0.3
library(RColorBrewer)
library(wordcloud)
## Warning: package &#39;wordcloud&#39; was built under R version 4.0.3
library(topicmodels)
## Warning: package &#39;topicmodels&#39; was built under R version 4.0.3
library(SnowballC)
## Warning: package &#39;SnowballC&#39; was built under R version 4.0.3
library(config)
## Warning: package &#39;config&#39; was built under R version 4.0.3
## 
## Attaching package: &#39;config&#39;
## The following objects are masked from &#39;package:base&#39;:
## 
##     get, merge</code></pre>
</div>
<div id="populate-with-your-httpsapps.twitter.com-application-information-to-use-my_setup-to-register-your-session.-no-you-cannot-see-mine" class="section level1">
<h1>Populate with your <a href="https://apps.twitter.com" class="uri">https://apps.twitter.com</a> application information to use my_setup() to register your session. No, you cannot see mine!</h1>
<p>If you haven’t used <code>config</code> before, check out the <a href="https://cran.r-project.org/web/packages/config/vignettes/introduction.html">documentation</a>. It’s a good way to import keys or passwords without sharing them public (just make sure they’re covered by your <code>.gitignore</code>!) <em>Note: Also add to <code>ignoreFiles</code> parameter in the <code>config.toml</code> if using hugo</em></p>
<pre class="r"><code>config &lt;- config::get(file = &#39;config.yml&#39;)
## Warning in readLines(con): incomplete final line found on &#39;C:
## \Users\rober\Documents\github\rjfranssen.github.io\content\docs\config.yml&#39;
config$trials
## [1] 5
config$dataset
## [1] &quot;data-sampled.csv&quot;

my_config &lt;- function() {
    ckey = &quot;Your Consumer Key Here&quot;
    csec = &quot;Your Consumer Secret Here&quot;
    akey = &quot;Your Access Token Here&quot;
    asec = &quot;Your Access Token Secret Here&quot;
  
    setup_twitter_oauth(ckey, csec, akey, asec)  
}</code></pre>
</div>
<div id="convenience-function-for-accessing-the-text-part-of-a-tweet" class="section level1">
<h1>Convenience function for accessing the text part of a tweet</h1>
</div>
<div id="returned-by-the-twitter-api.-is-used-below." class="section level1">
<h1>returned by the twitteR API. Is used below.</h1>
<p>tweet_text &lt;- function(x) x$getText()</p>
</div>
<div id="submit-a-search-query-terms-separated-by-and-get-a-return" class="section level1">
<h1>Submit a search query (terms separated by “+”) and get a return</h1>
</div>
<div id="set-of-data-corpus." class="section level1">
<h1>set of data (corpus).</h1>
<p>tweet_corpus &lt;- function(search, n = 5000, …) {
payload &lt;- searchTwitter(search, n = n, …)
sapply(payload, tweet_text)
}</p>
</div>
<div id="search-for-some-key-terms-try-to-grab-a-lot-if-you-want.-twitter-will" class="section level1">
<h1>Search for some key terms, try to grab a lot if you want. Twitter will</h1>
</div>
<div id="limit-you-as-it-sees-fit-can-find.-also-has-spatial-options." class="section level1">
<h1>limit you as it sees fit (can find). Also has spatial options.</h1>
</div>
<div id="try-these-sacramento-coordinates-38.630404-121.29353550mi" class="section level1">
<h1>Try these Sacramento coordinates: ‘38.630404,-121.293535,50mi’</h1>
<p>my_setup() # Setup the login for this session
tweets &lt;- tweet_corpus(“energy+electricity”, n = 10000, lang = ‘en’)</p>
</div>
<div id="save-your-corpus-because-youre-limited-in-how-often-you-can-do-this-for-free" class="section level1">
<h1>Save your corpus (because you’re limited in how often you can do this for free!)</h1>
<p>saveRDS(tweets, file = “Workspace/energy_themes/tweets.Rds”, compress = ‘xz’)</p>
</div>
<div id="okay-read-that-corpus-back-in-from-disk.-im-sure-you-have-a" class="section level1">
<h1>Okay, read that corpus back in from disk. I’m sure you have a</h1>
</div>
<div id="different-save-location-right" class="section level1">
<h1>different save location, right?</h1>
<p>tweets &lt;- readRDS(“Workspace/energy_themes/tweets.Rds”)</p>
</div>
<div id="okay-heres-where-things-get-tricky.-see-references-for-examples." class="section level1">
<h1>Okay, here’s where things get tricky. See references for examples.</h1>
</div>
<div id="problems-depends-if-your-system-is-using-parallel-processing.-if" class="section level1">
<h1>Problems? Depends if your system is using parallel processing. If</h1>
</div>
<div id="it-is-youll-need-to-use-mc.cores-parameters-as-shown-later.-that" class="section level1">
<h1>it is, you’ll need to use mc.cores parameters as shown later. That</h1>
</div>
<div id="took-me-awhile-to-get-thanks-to-the-references-for-clearing-that-up." class="section level1">
<h1>took me awhile to get! Thanks to the references for clearing that up.</h1>
</div>
<div id="here-we-pre-process-the-data-in-some-standard-ways.-ill-post-define-each-step" class="section level1">
<h1>Here we pre-process the data in some standard ways. I’ll post-define each step</h1>
<p>tweets &lt;- iconv(tweets, to = “ASCII”, sub = " “) # Convert to basic ASCII text to avoid silly characters
tweets &lt;- tolower(tweets) # Make everything consistently lower case
tweets &lt;- gsub(”rt“,” “, tweets) # Remove the”RT" (retweet) so duplicates are duplicates
tweets &lt;- gsub(“@\w+”, " “, tweets) # Remove user names (all proper names if you’re wise!)
tweets &lt;- gsub(”http.+ |http.+$“,” “, tweets) # Remove links
tweets &lt;- gsub(”[[:punct:]]“,” “, tweets) # Remove punctuation
tweets &lt;- gsub(”[ |{2,}“,” “, tweets) # Remove tabs
tweets &lt;- gsub(”amp“,” “, tweets) #”&amp;" is “&amp;amp” in HTML, so after punctuation removed …
tweets &lt;- gsub(“^”, "“, tweets) # Leading blanks
tweets &lt;- gsub(” $“,”“, tweets) # Lagging blanks
tweets &lt;- gsub(” +“,” ", tweets) # General spaces (should just do all whitespaces no?)
tweets &lt;- unique(tweets) # Now get rid of duplicates!</p>
</div>
<div id="convert-to-tm-corpus-and-use-its-api-for-some-additional-fun" class="section level1">
<h1>Convert to tm corpus and use its API for some additional fun</h1>
<p>corpus &lt;- Corpus(VectorSource(tweets)) # Create corpus object</p>
</div>
<div id="remove-english-stop-words.-this-could-be-greatly-expanded" class="section level1">
<h1>Remove English stop words. This could be greatly expanded!</h1>
</div>
<div id="dont-forget-the-mc.cores-thing" class="section level1">
<h1>Don’t forget the mc.cores thing</h1>
<p>corpus &lt;- tm_map(corpus, removeWords, stopwords(“en”), mc.cores=1)</p>
</div>
<div id="remove-numbers.-this-could-have-been-done-earlier-of-course." class="section level1">
<h1>Remove numbers. This could have been done earlier, of course.</h1>
<p>corpus &lt;- tm_map(corpus, removeNumbers, mc.cores=1)</p>
</div>
<div id="stem-the-words.-google-if-you-dont-understand" class="section level1">
<h1>Stem the words. Google if you don’t understand</h1>
<p>corpus &lt;- tm_map(corpus, stemDocument, mc.cores=1)</p>
</div>
<div id="remove-the-stems-associated-with-our-search-terms" class="section level1">
<h1>Remove the stems associated with our search terms!</h1>
<p>corpus &lt;- tm_map(corpus, removeWords, c(“energi”, “electr”), mc.cores=1)</p>
</div>
<div id="why-not-visualize-the-corpus-now" class="section level1">
<h1>Why not visualize the corpus now?</h1>
</div>
<div id="mine-had-a-lot-to-do-with-solar-power-renew-new-can-save-suppl-wind-price-use" class="section level1">
<h1>Mine had a lot to do with {solar, power, renew, new, can, save, suppl, wind, price, use}</h1>
<p>pal &lt;- brewer.pal(8, “Dark2”)
wordcloud(corpus, min.freq=2, max.words = 150, random.order = TRUE, col = pal)</p>
</div>
<div id="now-for-topic-modeling" class="section level1">
<h1>Now for Topic Modeling</h1>
</div>
<div id="get-the-lengths-and-make-sure-we-only-create-a-dtm-for-tweets-with" class="section level1">
<h1>Get the lengths and make sure we only create a DTM for tweets with</h1>
</div>
<div id="some-actual-content" class="section level1">
<h1>some actual content</h1>
<p>doc.lengths &lt;- rowSums(as.matrix(DocumentTermMatrix(corpus)))
dtm &lt;- DocumentTermMatrix(corpus[doc.lengths &gt; 0])
# model &lt;- LDA(dtm, 10) # Go ahead and test a simple model if you want</p>
</div>
<div id="now-for-some-topics" class="section level1">
<h1>Now for some topics</h1>
<p>SEED = sample(1:1000000, 1) # Pick a random seed for replication
k = 10 # Let’s start with 10 topics</p>
</div>
<div id="this-might-take-a-minute" class="section level1">
<h1>This might take a minute!</h1>
<p>models &lt;- list(
CTM = CTM(dtm, k = k, control = list(seed = SEED, var = list(tol = 10^-4), em = list(tol = 10^-3))),
VEM = LDA(dtm, k = k, control = list(seed = SEED)),
VEM_Fixed = LDA(dtm, k = k, control = list(estimate.alpha = FALSE, seed = SEED)),
Gibbs = LDA(dtm, k = k, method = “Gibbs”, control = list(seed = SEED, burnin = 1000,
thin = 100, iter = 1000))
)</p>
</div>
<div id="there-you-have-it.-models-now-holds-4-topics.-see-the-topicmodels-api-documentation-for-details" class="section level1">
<h1>There you have it. Models now holds 4 topics. See the topicmodels API documentation for details</h1>
</div>
<div id="top-10-terms-of-each-topic-for-each-model" class="section level1">
<h1>Top 10 terms of each topic for each model</h1>
</div>
<div id="do-you-see-any-themes-you-can-label-to-these-topics-lists-of-words" class="section level1">
<h1>Do you see any themes you can label to these “topics” (lists of words)?</h1>
<p>lapply(models, terms, 10)</p>
</div>
<div id="matrix-of-tweet-assignments-to-predominate-topic-on-that-tweet" class="section level1">
<h1>matrix of tweet assignments to predominate topic on that tweet</h1>
</div>
<div id="for-each-of-the-models-in-case-you-wanted-to-categorize-them" class="section level1">
<h1>for each of the models, in case you wanted to categorize them</h1>
<p>assignments &lt;- sapply(models, topics)</p>
<p><span class="citation">@rjfranssen</span></p>
<p>Leave a comment
No file chosen
Attach files by dragging &amp; dropping, selecting or pasting them.
© 2020 GitHub, Inc.
Terms
Privacy
Security
Status
Help
Contact GitHub
Pricing
API
Training
Blog
About</p>
</div>
